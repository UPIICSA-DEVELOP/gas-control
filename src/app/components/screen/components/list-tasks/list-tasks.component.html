<!--
  ~ Copyright (C) MapLander S de R.L de C.V - All Rights Reserved
  ~  Unauthorized copying of this file, via any medium is strictly prohibited
  ~  Proprietary and confidential
  -->

<div id="list-tasks">
  <mat-card class="container">
    <div class="header">
      <h4 *ngIf="!others">TAREAS</h4>
      <h4 *ngIf="others">OTROS</h4>
      <div class="filters">
        <div *ngIf="!reportConfig.reportView" class="settings">
          <mat-icon class="filter-icon">filter_list</mat-icon>
          <mat-chip-list>
            <mat-chip *ngIf="!others" [color]="'primary'" selected (click)="taskFilter()">
              Filtro por tareas:
              <span>&nbsp;{{typeFilter[filter]}}&nbsp;</span>
              <mat-icon>edit</mat-icon>
            </mat-chip>
            <mat-chip [color]="'primary'" selected (click)="dateFilter()">
              Fecha:
              <span *ngIf="today">&nbsp;{{start.textDate}}&nbsp;</span>
              <span *ngIf="!today">&nbsp;{{start.textDate}} - {{end.textDate}}&nbsp;</span>
              <mat-icon>edit</mat-icon>
            </mat-chip>
          </mat-chip-list>
        </div>
        <div class="search">
          <mat-spinner [color]="'primary'" *ngIf="load" [diameter]="24"></mat-spinner>
          <button *ngIf="others && !reportConfig.reportView" mat-icon-button (click)="resetFilters()">
            <mat-icon>refresh</mat-icon>
          </button>
          <button *ngIf="others && !reportConfig.reportView" mat-icon-button (click)="closeOthers()">
            <mat-icon>close</mat-icon>
          </button>
          <button mat-icon-button *ngIf="!others && !reportConfig.reportView" (click)="search()">
            <mat-icon>search</mat-icon>
          </button>
        </div>
      </div>
    </div>
    <mat-card-content>
      <div *ngIf="others; then secondList else firstList"></div>
      <ng-template #firstList>
        <div class="sub-container" (scroll)="onScroll($event)" #modalScroll>
          <div *ngIf="reportConfig.reportView; then reportForm else completeList"></div>
          <ng-template #reportForm>
            <div style="width: 95%">
              <div style="display: flex; justify-content: flex-end">
                <button *ngIf="reportConfig.status === 4 && user.role === 7" mat-icon-button (click)="editFormat()" matTooltip="Editar">
                  <mat-icon>edit</mat-icon>
                </button>
                <button mat-icon-button (click)="goBackList()" matTooltip="Cerrar bitacora">
                  <mat-icon>close</mat-icon>
                </button>
              </div>
              <ng-container [ngSwitch]="reportConfig.typeReportView">
                <div *ngSwitchCase="1">
                  <app-om-report [taskOMInfo]="reportConfig.taskElement" [utilities]="utils"></app-om-report>
                </div>
                <div *ngSwitchCase="2">
                  <app-compressor-report [taskCompInfo]="reportConfig.taskElement"></app-compressor-report>
                </div>
                <div *ngSwitchCase="4">
                  <app-vrs-report [taskVrsInfo]="reportConfig.taskElement"></app-vrs-report>
                </div>
                <div *ngSwitchCase="5">
                  <app-scanned-report [taskScannedInfo]="reportConfig.taskElement"></app-scanned-report>
                </div>
                <div *ngSwitchCase="8">
                  <app-fe-report [taskFeInfo]="reportConfig.taskElement"></app-fe-report>
                </div>
              </ng-container>
            </div>
          </ng-template>
          <ng-template #completeList>
            <div *ngIf="listTask.todayTasks.length === 0 && listTask.previousTasks.length === 0 && listTask.historyTasks.length === 0; then message else list"></div>
            <ng-template #list>
              <div class="card-list" *ngFor="let task of listTask.todayTasks;">
                <div *ngIf="task.type === 1; then dividerText else taskCard"></div>
                <ng-template #dividerText>
                  <div class="head-bold" style="margin: 8px 0">{{task.title}}</div>
                </ng-template>
                <ng-template #taskCard>
                  <mat-card (click)="goTaskInfo(task)" class="task">
                    <div class="priority" *ngIf="task.original.level === 3" style="background-color:#E00000"></div>
                    <div class="priority" *ngIf="task.original.level === 1" style="background-color:#257602"></div>
                    <div class="priority" *ngIf="task.original.level === 2" style="background-color:#FFD800"></div>
                    <mat-card-content>
                      <div class="date">
                        <div>
                          <div class="text-bold">{{task.original.date[0]}}</div>
                          <div class="text-bold">{{task.original.date[1]}}</div>
                        </div>
                      </div>
                      <div class="content">
                        <div class="head">{{task.original.name}}</div>
                        <div class="text">{{zones[task.original.zone-1]}}</div>
                        <div class="text">{{priority[task.original.level-1]}}</div>
                      </div>
                      <div style="position: absolute; top: 0; right: 0; margin: 16px;">
                        <mat-icon class="done" *ngIf="task.original.status === 4">check</mat-icon>
                        <mat-icon class="latest" *ngIf="task.original.status === 3">close</mat-icon>
                        <mat-icon class="pending" svgIcon="icons:task_previous" *ngIf=" task.original.status === 2"></mat-icon>
                      </div>
                      <div style="position: absolute; bottom: 0; right: 0; margin: 0 4px">
                        <button mat-icon-button type="button" (click)="goTaskInfo(task)" *ngIf="task.original.status !== 3" matTooltip="Abrir tarea">
                          <mat-icon>keyboard_arrow_down</mat-icon>
                        </button>
                      </div>
                    </mat-card-content>
                  </mat-card>
                </ng-template>
              </div>
              <div class="card-list" *ngFor="let task of listTask.previousTasks;">
                <div *ngIf="task.type === 1; then dividerText else taskCard"></div>
                <ng-template #dividerText>
                  <div class="head-bold" style="margin: 8px 0">{{task.title}}</div>
                </ng-template>
                <ng-template #taskCard>
                  <mat-card (click)="goTaskInfo(task)" class="task">
                    <div class="priority" *ngIf="task.original.level === 3" style="background-color:#E00000"></div>
                    <div class="priority" *ngIf="task.original.level === 1" style="background-color:#257602"></div>
                    <div class="priority" *ngIf="task.original.level === 2" style="background-color:#FFD800"></div>
                    <mat-card-content>
                      <div class="date">
                        <div>
                          <div class="text-bold">{{task.original.date[0]}}</div>
                          <div class="text-bold">{{task.original.date[1]}}</div>
                        </div>
                      </div>
                      <div class="content">
                        <div class="head">{{task.original.name}}</div>
                        <div class="text">{{zones[task.original.zone-1]}}</div>
                        <div class="text">{{priority[task.original.level-1]}}</div>
                      </div>
                      <div style="position: absolute; top: 0; right: 0; margin: 16px;">
                        <mat-icon style="color: #257602; font-size: 16px; width: 16px; height: 16px;" *ngIf="task.original.status === 4">check</mat-icon>
                        <mat-icon style="color: #E00000; font-size: 16px; width: 16px; height: 16px;" *ngIf="task.original.status === 3">close</mat-icon>
                        <mat-icon style="color: #707070; font-size: 16px; width: 16px; height: 16px;" svgIcon="icons:task_previous" *ngIf=" task.original.status === 2"></mat-icon>
                      </div>
                      <div style="position: absolute; bottom: 0; right: 0; margin: 0 4px">
                        <button mat-icon-button type="button" (click)="goTaskInfo(task)" *ngIf="task.original.status !== 3" matTooltip="Abrir tarea">
                          <mat-icon>keyboard_arrow_down</mat-icon>
                        </button>
                      </div>
                    </mat-card-content>
                  </mat-card>
                </ng-template>
              </div>
              <div class="card-list" *ngFor="let task of listTask.historyTasks;">
                <div *ngIf="task.type === 1; then dividerText else taskCard"></div>
                <ng-template #dividerText>
                  <div class="head-bold" style="margin: 8px 0">{{task.title}}</div>
                </ng-template>
                <ng-template #taskCard>
                  <mat-card class="task" (click)="goTaskInfo(task)">
                    <div class="priority" *ngIf="task.original.level === 3" style="background-color:#E00000"></div>
                    <div class="priority" *ngIf="task.original.level === 1" style="background-color:#257602"></div>
                    <div class="priority" *ngIf="task.original.level === 2" style="background-color:#FFD800"></div>
                    <mat-card-content>
                      <div class="date">
                        <div>
                          <div class="text-bold">{{task.original.date[0]}}</div>
                          <div class="text-bold">{{task.original.date[1]}}</div>
                        </div>
                      </div>
                      <div class="content">
                        <div class="head">{{task.original.name}}</div>
                        <div class="text">{{zones[task.original.zone-1]}}</div>
                        <div class="text">{{priority[task.original.level-1]}}</div>
                      </div>
                      <div style="position: absolute; top: 0; right: 0; margin: 16px;">
                        <mat-icon style="color: #257602; font-size: 16px; width: 16px; height: 16px;" *ngIf="task.original.status === 4">check</mat-icon>
                        <mat-icon style="color: #E00000; font-size: 16px; width: 16px; height: 16px;" *ngIf="task.original.status === 3">close</mat-icon>
                        <mat-icon style="color: #707070; font-size: 16px; width: 16px; height: 16px;" svgIcon="icons:task_previous" *ngIf=" task.original.status === 2"></mat-icon>
                      </div>
                      <div style="position: absolute; bottom: 0; right: 0; margin: 0 4px">
                        <button mat-icon-button type="button" (click)="goTaskInfo(task)" *ngIf="task.original.status !== 3 || user.role === 7" matTooltip="Abrir tarea">
                          <mat-icon>keyboard_arrow_down</mat-icon>
                        </button>
                      </div>
                    </mat-card-content>
                  </mat-card>
                </ng-template>
              </div>
            </ng-template>
            <ng-template #message>
              <div class="empty-list">
                <div *ngIf="!notCalendar; then taskInCreation else notTask"></div>
                <ng-template #taskInCreation>
                  <div *ngIf="load; then standBy else notExistTasks"></div>
                  <ng-template #standBy>
                    <div *ngIf="load" class="message">Espere un momento por favor...</div>
                  </ng-template>
                  <ng-template #notExistTasks>
                    <div class="notFoundTasks" *ngIf=" emptyLisTasks && !load">No existen resultados para su búsqueda</div>
                    <div class="notFoundTasks" *ngIf=" emptyLisTasks && load">Cargando tareas...</div>
                    <div *ngIf="!emptyLisTasks &&!load" class="message">La Estación no cuenta por el momento con tareas programadas, por favor consulte mañana</div>
                  </ng-template>
                </ng-template>
                <ng-template #notTask>
                  <div class="message">Para continuar, es necesario calendarizar las tareas faltantes de la Estación</div>
                  <div class="action">
                    <button mat-flat-button type="button" (click)="createStationTasks()">IR A TAREAS</button>
                  </div>
                </ng-template>
              </div>
            </ng-template>
          </ng-template>
        </div>
      </ng-template>
      <ng-template #secondList>
        <div class="sub-container" (scroll)="onScroll($event)" #modalScroll>
          <mat-tab-group (selectedTabChange)="getNotCalendarTask($event)" style="width: 100%">
            <mat-tab [disabled]="reportConfig.reportView" label="Recepción y descarga de combustible">
              <div *ngIf="notCalendarTasks.length !== 0; then listFR else emptyFR"></div>
              <ng-template #listFR>
                <div *ngIf="reportConfig.reportView; then frReportView else frList"></div>
                <ng-template #frReportView>
                  <div style="width: 95%">
                    <div style="display: flex; justify-content: flex-end">
                      <button mat-icon-button *ngIf="user.role === 7" (click)="editFormat()" matTooltip="Editar">
                        <mat-icon>edit</mat-icon>
                      </button>
                      <button mat-icon-button (click)="goBackList()" matTooltip="Cerrar bitacora">
                        <mat-icon>close</mat-icon>
                      </button>
                    </div>
                    <app-fr-report [taskFrInfo]="reportConfig.taskElement"></app-fr-report>
                  </div>
                </ng-template>
                <ng-template #frList>
                  <div class="card-list" *ngFor="let task of notCalendarTasks;">
                    <mat-card class="task" (click)="goTaskInfo(task, 7)" style="margin-top: 8px">
                      <div class="priority" style="background-color:#E00000"></div>
                      <mat-card-content>
                        <div class="date">
                          <div>
                            <div class="text-bold">{{task.date[0]}}</div>
                            <div class="text-bold">{{task.date[1]}}</div>
                          </div>
                        </div>
                        <div class="content">
                          <div class="head">Descarga de combustible</div>
                          <div class="text"></div>
                          <div class="text">Crítico</div>
                        </div>
                        <div style="position: absolute; bottom: 0; right: 0; margin: 0 4px">
                          <button mat-icon-button type="button" (click)="goTaskInfo(task, 7)" matTooltip="Abrir tarea">
                            <mat-icon>keyboard_arrow_down</mat-icon>
                          </button>
                        </div>
                      </mat-card-content>
                    </mat-card>
                  </div>
                </ng-template>
              </ng-template>
              <ng-template #emptyFR>
                <div class="empty-list">
                  <div class="message" style="margin-top: 128px;">Aún no hay reportes en su lista</div>
                </div>
              </ng-template>
            </mat-tab>
            <mat-tab [disabled]="reportConfig.reportView" label="Incidencias">
              <div *ngIf="notCalendarTasks.length !== 0; then listIN else emptyIN"></div>
              <ng-template #listIN>
                <div *ngIf="reportConfig.reportView; then incidenceReportView else incidenceList"></div>
                <ng-template #incidenceReportView>
                  <div style="width: 95%">
                    <div style="display: flex; justify-content: flex-end">
                      <button mat-icon-button *ngIf="user.role === 7" (click)="editFormat()" matTooltip="Editar">
                        <mat-icon>edit</mat-icon>
                      </button>
                      <button mat-icon-button (click)="goBackList()" matTooltip="Cerrar bitacora">
                        <mat-icon>close</mat-icon>
                      </button>
                    </div>
                    <app-incidence-report [taskIncidenceInfo]="reportConfig.taskElement" [utilities]="utils"></app-incidence-report>
                  </div>
                </ng-template>
                <ng-template #incidenceList>
                  <div class="card-list" *ngFor="let task of notCalendarTasks;">
                    <mat-card (click)="goTaskInfo(task, 9)" class="task" style="margin-top: 8px">
                        <div class="priority" style="background-color:#E00000"></div>
                        <mat-card-content>
                          <div class="date">
                            <div>
                              <div class="text-bold">{{task.date[0]}}</div>
                              <div class="text-bold">{{task.date[1]}}</div>
                            </div>
                          </div>
                          <div class="content">
                            <div class="head">Incidencia</div>
                            <div class="text"></div>
                            <div class="text">Crítico</div>
                          </div>
                          <div style="position: absolute; bottom: 0; right: 0; margin: 0 4px">
                            <button mat-icon-button type="button" (click)="goTaskInfo(task, 9)" matTooltip="Abrir tarea">
                              <mat-icon>keyboard_arrow_down</mat-icon>
                            </button>
                          </div>
                        </mat-card-content>
                      </mat-card>
                  </div>
                </ng-template>
              </ng-template>
              <ng-template #emptyIN>
                <div class="empty-list">
                  <div class="message" style="margin-top: 128px;">Aún no hay reportes en su lista</div>
                </div>
              </ng-template>
            </mat-tab>
            <mat-tab [disabled]="reportConfig.reportView" label="Recolección de residuos peligrosos">
              <div *ngIf="notCalendarTasks.length !== 0; then listHWC else emptyHWC"></div>
              <ng-template #listHWC>
                <div *ngIf="reportConfig.reportView; then frReportView else frList"></div>
                <ng-template #frReportView>
                  <div style="width: 95%">
                    <div style="display: flex; justify-content: flex-end">
                      <button mat-icon-button *ngIf="user.role === 7" (click)="editFormat()" matTooltip="Editar">
                        <mat-icon>edit</mat-icon>
                      </button>
                      <button mat-icon-button (click)="goBackList()" matTooltip="Cerrar bitacora">
                        <mat-icon>close</mat-icon>
                      </button>
                    </div>
                    <app-hwc-report [taskHwcInfo]="reportConfig.taskElement"></app-hwc-report>
                  </div>
                </ng-template>
                <ng-template #frList>
                  <div class="card-list" *ngFor="let task of notCalendarTasks;">
                    <mat-card (click)="goTaskInfo(task, 6)" class="task" style="margin-top: 8px">
                      <div class="priority" style="background-color:#E00000"></div>
                      <mat-card-content>
                        <div class="date">
                          <div>
                            <div class="text-bold">{{task.date[0]}}</div>
                            <div class="text-bold">{{task.date[1]}}</div>
                          </div>
                        </div>
                        <div class="content">
                          <div class="head">Recolección de residuos peligrosos</div>
                          <div class="text"></div>
                          <div class="text">Crítico</div>
                        </div>
                        <div style="position: absolute; bottom: 0; right: 0; margin: 0 4px">
                          <button mat-icon-button type="button" (click)="goTaskInfo(task, 6)" matTooltip="Abrir tarea">
                            <mat-icon>keyboard_arrow_down</mat-icon>
                          </button>
                        </div>
                      </mat-card-content>
                    </mat-card>
                  </div>
                </ng-template>
              </ng-template>
              <ng-template #emptyHWC>
                <div class="empty-list">
                  <div class="message" style="margin-top: 128px;">Aún no hay reportes en su lista</div>
                </div>
              </ng-template>
            </mat-tab>
          </mat-tab-group>
        </div>
      </ng-template>
    </mat-card-content>
  </mat-card>
</div>

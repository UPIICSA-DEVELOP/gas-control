<!--
  ~ Copyright (C) MapLander S de R.L de C.V - All Rights Reserved
  ~  Unauthorized copying of this file, via any medium is strictly prohibited
  ~  Proprietary and confidential
  -->

<div id="compressor-report">
  <div style="display: flex; justify-content: center; margin: 8px 0; text-align: center;">
    <div *ngIf="task" style="font-weight: 600; font-size: 18px;">{{task.original.name}}</div>
  </div>
  <div class="task-header">
    <div class="head-bold">Compresor de aire</div>
    <div class="control-data">
      <div *ngIf="compressorReport">Fecha: {{date[0]}} {{date[1]}} {{date[2]}}&nbsp;&nbsp;</div>
      <div *ngIf="compressorReport && compressorReport.folio">Folio: {{compressorReport.folio | formatFolio}}</div>
    </div>
  </div>
  <form [formGroup]="compForm" class="flex-box">
    <div class="columns">
      <div class="times">
        <mat-form-field class="clock">
          <input formControlName="startTime" placeholder="Hora de inicio" matInput required appDisableWrite (time)="changeTime($event, 'startTime')" value="{{compForm.controls['startTime'].value | formatTime}}">
          <mat-error *ngIf="compForm.controls['startTime'].hasError('required')">
            Este campo es obligatorio
          </mat-error>
        </mat-form-field>
        <mat-form-field class="clock">
          <input formControlName="endTime" placeholder="Hora de término" matInput required appDisableWrite (time)="changeTime($event, 'endTime')" value="{{compForm.controls['endTime'].value | formatTime}}">
          <mat-error *ngIf="compForm.controls['endTime'].hasError('required')">
            Este campo es obligatorio
          </mat-error>
        </mat-form-field>
      </div>
      <mat-form-field class="inputs">
        <input formControlName="brand" matInput placeholder="Marca">
      </mat-form-field>
      <mat-form-field class="inputs">
        <input formControlName="model" matInput placeholder="Modelo">
      </mat-form-field>
      <mat-form-field class="inputs">
        <input formControlName="controlNumber" matInput placeholder="No. de control">
      </mat-form-field>
      <div style="display: flex; align-items: center; width: 90%;">
        <mat-form-field style="width: 75%">
          <mat-select formControlName="pressure" placeholder="Presión del manómetro" required>
            <mat-option [value]="7">7</mat-option>
            <mat-option [value]="8">8</mat-option>
            <mat-option [value]="9">9</mat-option>
          </mat-select>
        </mat-form-field>
        <div class="color" style="margin-left: 16px">Kg/cm<sup>2</sup></div>
      </div>
      <mat-form-field class="inputs">
        <mat-select formControlName="purge" placeholder="Purga o descarga" required>
          <mat-option value="Función correcta">Función correcta</mat-option>
          <mat-option value="Función incorrecta">Función incorrecta</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field class="inputs">
        <mat-select formControlName="securityValve" placeholder="Disparo manual de válvula de seguridad" required>
          <mat-option value="Función correcta">Función correcta</mat-option>
          <mat-option value="Función incorrecta">Función incorrecta</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field class="inputs">
        <input formControlName="modifications" matInput placeholder="Modificaciones y medidas correctivas">
      </mat-form-field>
    </div>
    <div class="columns">
      <mat-form-field class="inputs">
        <input formControlName="observations" matInput placeholder="Observaciones">
      </mat-form-field>
      <div class="image-header">
        Captura fotográfica de la evidencia
      </div>
      <div *ngIf="!editable; then showEv else modify"></div>
      <ng-template #showEv>
        <div *ngIf="!compressorReport || !compressorReport.fileCS" class="image-container" >
          <mat-icon class="default-image">image</mat-icon>
        </div>
        <div *ngIf="compressorReport && compressorReport.fileCS " class="image-container-real" (click)="seeEvidence()">
          <img class="evidence" [src]="compressorReport.fileCS.thumbnail" alt="Evidence capture">
        </div>
      </ng-template>
      <ng-template #modify>
        <app-upload-file class="inputs" (onLoad)="loadEvidence($event)" (onRemove)="deleteEvidence()" [layoutTemplate]="imageEvidence" [type]="'image'">
          <ng-template #imageEvidence>
            <div *ngIf="!evidenceThumbnail" class="image-container" >
              <mat-icon class="default-image">image</mat-icon>
            </div>
            <div *ngIf="evidenceThumbnail" class="image-container-real">
              <img class="evidence" [src]="evidenceThumbnail" alt="Evidence capture">
            </div>
          </ng-template>
        </app-upload-file>
      </ng-template>
      <div class="text-sign">
        Nombre y firma del responsable
      </div>
      <div class="inputs">
        <div *ngIf="!editable; then showSign else loadSign"></div>
        <ng-template #showSign>
          <div class="signature-element">
            <img *ngIf="compressorReport && compressorReport.signature" [src]="compressorReport.signature.thumbnail">
            <div *ngIf="!compressorReport || !compressorReport.signature" style="width: 60%; height: 60px"></div>
          </div>
        </ng-template>
        <ng-template #loadSign>
          <div class="signature-element" (click)="loadSignature()" style="cursor: pointer" matTooltip="Cargar Firma">
            <img *ngIf="signatureThumbnail" [src]="signatureThumbnail">
            <div *ngIf="!signatureThumbnail" style="width: 60%; height: 60px"></div>
          </div>
        </ng-template>
        <div class="divider"></div>
        <div *ngIf="editable; then admonName else originalName"></div>
        <ng-template #admonName>
          <div class="name">{{name}}</div>
        </ng-template>
        <ng-template #originalName>
          <div *ngIf="!compressorReport || !compressorReport.name" class="name">Nombre</div>
          <div *ngIf="compressorReport && compressorReport.name" class="name">{{compressorReport.name}}</div>
        </ng-template>
      </div>
    </div>
  </form>
  <div class="divider" *ngIf="task.original.hwg"></div>
  <div *ngIf="task.original.hwg && compressorReport">
    <app-hwg-report [taskHwgInfo]="compressorReport.hwgReport || undefined"></app-hwg-report>
  </div>
  <div *ngIf="task.original.hwg && !compressorReport">
    <app-hwg-report [taskHwgInfo]="undefined"></app-hwg-report>
  </div>
  <div *ngIf="taskItems && taskItems.length !== 0 && !editable">
    <mat-paginator [pageSize]="1" [length]="taskItems.length" [hidePageSize]="true" (page)="changeTask($event)" ></mat-paginator>
  </div>
  <div *ngIf="editable" style="width: 100%; display: flex; justify-content: center">
    <button mat-flat-button (click)="validateForm(compForm.value)" [color]="'primary'">
      FINALIZAR
    </button>
  </div>
</div>
